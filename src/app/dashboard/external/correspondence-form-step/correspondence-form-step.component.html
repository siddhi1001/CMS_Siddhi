<div class="form_eic_cont_wrapper" *ngIf="progbar">
  <mat-spinner></mat-spinner>
</div>
<div class="form_eic_cont_wrapper" *ngIf="!progbar">
  <ng-scrollbar thumbClass="scroll_001" class="correspondence_detail scroll_wrp_001" *ngIf="expandedRightAction"
    [ngClass]="expandedAction ? 'unActive' : 'ActiveLeft'">
    <button (click)="expandeActionLeftButton()" matRipple class="corsp_ext_btn">
      <img src="{{basehref}}assets/images/icons/full-screen.svg" alt="">
    </button>
    <!-- <div class="detail_header">
      <div class="header_text" *ngIf = "correspondenceData">
        <div class="header_back_cpd_dtl">
          <button class="back_btn" (click)="backNavigation()">
            <img src="{{basehref}}assets/images/icons/left_arrow.svg" alt="">
          </button>
          <h3 class="text_23 ltg_text" *ngIf="taskTitle">{{taskTitle}}</h3>
          <h3 class="text_23 ltg_text">: {{correspondenceData.CorrFolderName }} - {{CorrespondencType}}</h3>
        </div>
      </div>
    </div> -->
    <div class="detail_header">
      <div class="header_text" *ngIf="correspondenceData">
        <div class="header_back_cpd_dtl">
          <button class="back_btn" (click)="backNavigation()">
            <img src="{{basehref}}assets/images/icons/left_arrow.svg" alt="">
          </button>
          <h3 class="text_23 ltg_text">{{taskTitle}}</h3>
        </div>
        <div>
          <br />
          <h4 class="">{{correspondenceData.CorrFolderName }} - {{CorrespondencType}}</h4>
        </div>
      </div>
    </div>
    <form [formGroup]="senderDetailsForm" class="sender-section">
      <div class="sender_wrapper corspnt_item">
        <div class="acdn_open_header">
          <div class="icon_wrapper">
            <div class="icon_typ icon_typ_001">
              <img src="{{basehref}}assets/images/icons/sender_mail_icon.svg" alt="">
            </div>
          </div>
          <p class="title_001">{{'sender'| translator}}</p>
        </div>
        <div class="corres_data_area">
          <div class="corres_table_wrapper" #senderContainer (resized)="onResized($event)">
            <table class="sender-table">
              <thead>
                <tr>
                  <th *ngFor="let col of senderTableStructure" [style.width]="senderColWidth + '%'">
                    {{col.columnName}}</th>
                  <th [style.width]="senderIconWidth + '%'"></th>
                </tr>
              </thead>
              <tbody *ngIf="correspondenceSenderDetailsData">
                <tr>
                  <td *ngFor="let col of senderTableStructure" [ngSwitch]="col.columnDef"
                    [style.width]="senderColWidth + '%'">
                    <div *ngSwitchCase="'OrganizationName'" class="input_item_wrp sm_input_wrapper">
                      <mat-form-field class="input_tbl_wrp">
                        <input type="text" aria-label="Number" matInput formControlName="ExternalOrganization"
                          [matAutocomplete]="extOrgName" required>
                        <mat-autocomplete #extOrgName="matAutocomplete" class="longautocomplete"
                          [displayWith]="displaySearchFilterValueExt">
                          <mat-option *ngFor="let OrgName of (filteredExtOrgNames | async)" [value]="OrgName"
                            (onSelectionChange)="optionSelectionChangeExternal(OrgName, $event)">
                            {{OrgName?.OrgName_En}}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                    </div>
                    <div *ngSwitchCase="'DepartmentName'" class="input_item_wrp sm_input_wrapper">
                      <mat-form-field class="input_tbl_wrp">
                        <input type="text" aria-label="Number" matInput formControlName="SenderDepartment">
                      </mat-form-field>
                    </div>
                    <div *ngSwitchCase="'Name'" class="input_item_wrp sm_input_wrapper">
                      <mat-form-field class="input_tbl_wrp">
                        <input type="text" aria-label="Number" matInput formControlName="SenderName" [(ngModel)]="name">
                      </mat-form-field>
                    </div>
                  </td>
                  <td class="btn_td_wrp" [style.width]="senderIconWidth + '%'">
                    <div class="btn_td_wrp_flex">
                      <button (click)="clearDetails('senderDetailsForm')" class="remove_btn_002" mat-button
                      [matTooltip]="'clear' | translator">
                        <img src="{{basehref}}assets/images/icons/remove_icon_001.svg" alt="">
                      </button>
                      <i *ngIf="senderTableStructureDetails.length > 0"
                        (click)="expandedSenderElement = !expandedSenderElement" class="material-icons">
                        {{expandedSenderElement ? "keyboard_arrow_up" : "keyboard_arrow_down"}}</i>
                    </div>
                  </td>
                </tr>
                <tr class="detail-row">
                  <td [attr.colspan]="senderTableStructure.length + 1">
                    <div class="element-detail" [@detailExpand]="expandedSenderElement ? 'expanded' : 'collapsed'">
                      <div class="detail-parameters active-details">
                        <table style="width:100%" class="sender-table-details">
                          <tr *ngFor="let col of senderTableStructureDetails">
                            <th>{{col.columnName}}</th>
                            <td [ngSwitch]="col.columnDef">
                              <div *ngSwitchCase="'OrganizationName'" class="input_item_wrp sm_input_wrapper">
                                <mat-form-field class="input_tbl_wrp">
                                  <input type="text" aria-label="Number" matInput formControlName="ExternalOrganization"
                                    [matAutocomplete]="extOrgName" required>
                                  <mat-autocomplete #extOrgName="matAutocomplete" class="longautocomplete"
                                    [displayWith]="displaySearchFilterValueExt">
                                    <mat-option *ngFor="let OrgName of (filteredExtOrgNames | async)" [value]="OrgName"
                                      (onSelectionChange)="optionSelectionChangeExternal(OrgName, $event)">
                                      {{OrgName?.OrgName_En}}
                                    </mat-option>
                                  </mat-autocomplete>
                                </mat-form-field>
                              </div>
                              <div *ngSwitchCase="'DepartmentName'" class="input_item_wrp sm_input_wrapper">
                                <mat-form-field class="input_tbl_wrp">
                                  <input type="text" aria-label="Number" matInput formControlName="SenderDepartment">
                                </mat-form-field>
                              </div>
                              <div *ngSwitchCase="'Name'" class="input_item_wrp sm_input_wrapper">
                                <mat-form-field class="input_tbl_wrp">
                                  <input type="text" aria-label="Number" matInput formControlName="SenderName"
                                    [(ngModel)]="name">
                                </mat-form-field>
                              </div>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <button class="show_preview_btn" (click)="showSenderData()">
          <img src="{{basehref}}assets/images/icons/plus_green_btn.svg" alt="">
          <span>{{'select_sender'| translator}}</span>
        </button>
      </div>
    </form>
    <form [formGroup]="recipientDetailsForm">
      <div class="recipient_wrapper corspnt_item">
        <div class="acdn_open_header">
          <div class="icon_wrapper">
            <div class="icon_typ icon_typ_002">
              <img src="{{basehref}}assets/images/icons/add-user.svg" alt="">
            </div>
          </div>
          <p class="title_001">{{'recipient'| translator}}</p>
        </div>
        <div class="corres_data_area">
          <div class="corres_table_wrapper">
            <table class="table">
              <tr>
                <th class="orgcolumn">{{'organization'| translator}}</th>
                <th class="department">{{'department'| translator}}</th>
                <th class="role">{{'role'| translator}}</th>
                <th>{{'name'| translator}}</th>
                <th class="btn_td_wrp"></th>
              </tr>
              <tr *ngIf=correspondenceRecipientDetailsData>
                <td class="orgcolumn">
                  {{IntRecipientInfo ? IntRecipientInfo.OrgName_En : correspondenceRecipientDetailsData.OrganizationName_EN}}
                </td>
                <td>
                  <div class="input_item_wrp sm_input_wrapper">
                    <mat-form-field class="input_tbl_wrp">
                      <input type="text" aria-label="Number" matInput formControlName="RecipientDepartment"
                        [matAutocomplete]="recpientDepName">
                      <mat-autocomplete #recpientDepName="matAutocomplete" class="longautocomplete"
                        [displayWith]="displaySearchFilterValueInt">
                        <mat-option *ngFor="let DepName of (filteredIntDepNames | async)" [value]="DepName"
                          (onSelectionChange)="optionSelectionChangeInternal(DepName, $event)">
                          <span>{{DepName?.DepName_En}}</span><span *ngIf="DepName.SecName_En">,
                            {{DepName.SecName_En}}</span>
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>
                  </div>
                </td>
                <td>{{IntRecipientInfo ? IntRecipientInfo.RoleName_En : correspondenceRecipientDetailsData.Role_EN}}
                </td>
                <td>
                  <div class="input_item_wrp sm_input_wrapper">
                    <mat-form-field class="input_tbl_wrp">
                      <input type="text" aria-label="Number" matInput formControlName="RecipientName">
                    </mat-form-field>
                  </div>
                </td>
                <td class="btn_td_wrp">
                  <button (click)="clearDetails('recipientDetailsForm')" class="remove_btn_002" mat-button>
                    <img src="{{basehref}}assets/images/icons/remove_icon_001.svg" alt="">
                  </button>
                </td>
              </tr>
            </table>
          </div>
          <button class="show_preview_btn" (click)="showRecipientData()">
            <img src="{{basehref}}assets/images/icons/plus_green_btn.svg" alt="">
            <span>{{'select_recipient'| translator}}</span>
          </button>
        </div>
      </div>
    </form>
    <div class="corres_acdn_warapper mat_accordion_001">
      <mat-accordion multi="true">
        <form [formGroup]="ccDetailsForm">
          <mat-expansion-panel class="mat-elevation-z bg_001">
            <mat-expansion-panel-header (click)="ccShowData();">
              <div class="icon_wrapper">
                <div class="icon_typ icon_typ_003">
                  <img src="{{basehref}}assets/images/icons/crsp_cc_iocn_white.svg" alt="">
                </div>
              </div>
              <p class="title_001">{{'cc'| translator}}</p>
            </mat-expansion-panel-header>
            <div class="corres_data_area">
              <div *ngIf="ccProgbar" class="spinner_sm_wrappar">
                <mat-spinner class="spinner_sm"></mat-spinner>
              </div>
              <div *ngIf="!ccProgbar" class="corres_table_wrapper">
                <table class="table">
                  <tr>
                    <th>{{'department'| translator}}</th>
                    <th>{{'role'| translator}}</th>
                    <th>{{'name'| translator}}</th>
                    <th class="btn_td_wrp"></th>
                  </tr>
                  <tbody>
                    <tr formArrayName="CCDetails"
                      *ngFor="let cc of ccDetailsForm.get('CCDetails').controls; let i = index;">
                      <ng-container>
                        <td class="CCtable">
                          {{cc.controls.departmentName.value}}</td>
                        <td class="CCtable">
                          {{cc.controls.role.value}}</td>
                        <td class="CCtable">
                          {{cc.controls.name.value}}</td>
                        <td class="btn_td_wrp">
                          <button (click)="removeCC(i)" class="remove_btn_002" mat-button [matTooltip]="'clear' | translator">
                            <img src="{{basehref}}assets/images/icons/remove_icon_001.svg" alt="">
                          </button>
                        </td>
                      </ng-container>
                    </tr>
                  </tbody>
                </table>
              </div>
              <button class="show_preview_btn" (click)="showCCData()">
                <img src="{{basehref}}assets/images/icons/plus_green_btn.svg" alt="">
                <span>{{'select_cc'| translator}}</span>
              </button>
            </div>
          </mat-expansion-panel>
        </form>

        <mat-expansion-panel class="mat-elevation-z">
          <mat-expansion-panel-header>
            <div class="icon_wrapper">
              <div class="icon_typ icon_typ_004">
                <img src="{{basehref}}assets/images/icons/crsp_icon_white.svg" alt="">
              </div>
            </div>
            <p class="title_001">{{'correspondence'| translator}}</p>
          </mat-expansion-panel-header>
          <div class="corres_data_area">
            <div *ngIf="coverProgbar" class="spinner_sm_wrappar">
              <mat-spinner class="spinner_sm"></mat-spinner>
            </div>
            <div *ngIf="!coverProgbar" class="corres_fld_wrapper">
              <form class="cust_row" [formGroup]="correspondenceDetailsForm" (ngSubmit)="checkFields()">
                <mat-form-field class="col_6" *ngIf="showCorrItems.regDate.Show">
                  <input matInput [placeholder]="'reg_date' | translator" formControlName="regDate">
                </mat-form-field>
                <div class="doc_date_wrp col_6">
                  <mat-form-field class="" *ngIf="showCorrItems.docsDate.Show">
                    <input matInput [placeholder]="'doc_date' | translator" [owlDateTimeTrigger]="docDate" [owlDateTime]="docDate"
                      autocomplete="off" formControlName="docsDate" [required]="showCorrItems.docsDate.Reguired">
                    <owl-date-time [pickerType]="'calendar'" #docDate></owl-date-time>
                  </mat-form-field>
                  <mat-checkbox formControlName="confidential" *ngIf="showCorrItems.confidential.Show">{{'confidential'| translator}}
                  </mat-checkbox>
                </div>

                <mat-form-field class="col_6" *ngIf="showCorrItems.priority.Show">
                  <input matInput type="text" [(ngModel)]="PriorityVal" [placeholder]="'priority' | translator"
                    [matAutocomplete]="Priority" formControlName="priority"
                    [required]="showCorrItems.priority.Reguired">
                  <mat-autocomplete autoActiveFirstOption #Priority="matAutocomplete" [displayWith]="displayFn">
                    <mat-option *ngFor="let option of MetadataFilters | attrfilter:'Priority':PriorityVal"
                      [value]="option">
                      {{option.EN}}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>

                <mat-form-field class="col_6" *ngIf="showCorrItems.refNumber.Show">
                  <input matInput autocomplete="off" [placeholder]="'ref_number' | translator" formControlName="refNumber"
                    [required]="showCorrItems.refNumber.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.personalName.Show">
                  <input matInput autocomplete="off" [placeholder]="'personal_name' | translator" formControlName="personalName"
                    [(ngModel)]="name" [required]="showCorrItems.personalName.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.idNumber.Show">
                  <input matInput autocomplete="off" [placeholder]="'id_number' | translator" formControlName="idNumber"
                    [required]="showCorrItems.idNumber.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.correspondenceType.Show">
                  <input type="text" [(ngModel)]="CorrespondenceTypeVal" [placeholder]="'correspondence_type' | translator" matInput
                    [matAutocomplete]="CorrespondenceType" formControlName="correspondenceType"
                    [required]="showCorrItems.correspondenceType.Reguired">
                  <mat-autocomplete #CorrespondenceType="matAutocomplete" [displayWith]="displayFn"
                    autoActiveFirstOption>
                    <mat-option
                      *ngFor="let option of MetadataFilters | attrfilter:'CorrespondenceType':CorrespondenceTypeVal"
                      [value]="option">
                      {{option.EN}}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.baseType.Show">
                  <input type="text" [(ngModel)]="BaseTypeVal" [placeholder]="'base_type' | translator" matInput
                    [matAutocomplete]="BaseType" formControlName="baseType"
                    [required]="showCorrItems.baseType.Reguired">
                  <mat-autocomplete #BaseType="matAutocomplete" [displayWith]="displayFn" autoActiveFirstOption>
                    <mat-option *ngFor="let option of MetadataFilters | attrfilter:'BaseType':BaseTypeVal"
                      [value]="option">
                      {{option.EN}}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <mat-form-field class="col_12" *ngIf="showCorrItems.arabicSubject.Show">
                  <input matInput autocomplete="off" [placeholder]="'arabic_subject' | translator" formControlName="arabicSubject"
                    [required]="showCorrItems.arabicSubject.Reguired">
                </mat-form-field>
                <mat-form-field class="col_12" *ngIf="showCorrItems.englishSubject.Show">
                  <input matInput autocomplete="off" [placeholder]="'english_subject' | translator" formControlName="englishSubject"
                    [required]="showCorrItems.englishSubject.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.projectCode.Show">
                  <input matInput autocomplete="off" [placeholder]="'project_code' | translator" formControlName="projectCode"
                    [required]="showCorrItems.projectCode.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.budgetNumber.Show">
                  <input matInput autocomplete="off" [placeholder]="'budget_number' | translator" formControlName="budgetNumber"
                    [required]="showCorrItems.budgetNumber.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.contractNumber.Show">
                  <input matInput autocomplete="off" [placeholder]="'contract_number' | translator" formControlName="contractNumber"
                    [required]="showCorrItems.contractNumber.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.tenderNumber.Show">
                  <input matInput autocomplete="off" [placeholder]="'tender_number' | translator" formControlName="tenderNumber"
                    [required]="showCorrItems.tenderNumber.Reguired">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.corrNumber.Show" disabled>
                  <input matInput autocomplete="off" [placeholder]="'corr_number' | translator" formControlName="corrNumber">
                </mat-form-field>
                <mat-form-field class="col_6" *ngIf="showCorrItems.fillinPlanPath.Show">
                  <input type="text" [(ngModel)]="FillingPlanPathVal" [placeholder]="'filling_plan_path' | translator"  matInput
                    [matAutocomplete]="FillingPlanPath" formControlName="fillinPlanPath"
                    [required]="showCorrItems.fillinPlanPath.Reguired">
                  <mat-autocomplete #FillingPlanPath="matAutocomplete" [displayWith]="displayFn" autoActiveFirstOption>
                    <mat-option *ngFor="let option of MetadataFilters | attrfilter:'FillingPlanPath':FillingPlanPathVal"
                      [value]="option">
                      {{option.EN}}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>

                <mat-form-field class="col_6" *ngIf="showCorrItems.dispatchMethod.Show">
                  <input type="text" [(ngModel)]="DispatchMethodVal" [placeholder]="'dispatch_method' | translator" matInput
                    [matAutocomplete]="DispatchMethod" formControlName="dispatchMethod"
                    [required]="showCorrItems.dispatchMethod.Reguired">
                  <mat-autocomplete #DispatchMethod="matAutocomplete" [displayWith]="displayFn" autoActiveFirstOption>
                    <mat-option *ngFor="let option of MetadataFilters | attrfilter:'DispatchMethod':DispatchMethodVal"
                      [value]="option">
                      {{option.EN}}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>

                <mat-form-field class="col_6" *ngIf="showCorrItems.staffNumber.Show">
                  <input matInput autocomplete="off" [placeholder]="'staff_number' | translator" formControlName="staffNumber"
                    [required]="showCorrItems.staffNumber.Reguired">
                </mat-form-field>
              </form>
            </div>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel class="mat-elevation-z bg_001">
          <mat-expansion-panel-header>
            <div class="icon_wrapper">
              <div class="icon_typ icon_typ_005">
                <img src="{{basehref}}assets/images/icons/cover-document.svg" alt="">
              </div>
            </div>
            <p class="title_001">{{'cover'| translator}}</p>
          </mat-expansion-panel-header>
          <div class="corres_data_area">
            <ul class="cl_btn_group">
              <li class="cl_btn_wrp">
                <button class="cl_btn cl_btn_001" (click)="refreshCoverSection()">
                  <img src="{{basehref}}assets/images/icons/refresh_arrow_white.svg" alt="">
                </button>
              </li>
              <li class="cl_btn_wrp">
                <div class="image-upload" *ngIf="!coverID">
                  <label for="file-input" class="cl_btn cl_btn_002" [matTooltip]="'add_document' | translator">
                    <img src="{{basehref}}assets/images/icons/cl_file_add_doc.svg" alt="">
                  </label>
                  <input id="file-input" type="file"
                    (change)="uploadCSDocument($event.target.files,correspondenceData.AttachCorrCoverID,'COVER')" />
                </div>
              </li>
              <li class="cl_btn_wrp">
                <button class="cl_btn cl_btn_003" [matTooltip]="'enterprise_connect' | translator">
                  <img src="{{basehref}}assets/images/icons/scanner_white.svg" alt="">
                </button>
              </li>
              <li class="cl_btn_wrp">
                <button class="cl_btn cl_btn_004" [matTooltip]="'scan' | translator">
                  <img src="{{basehref}}assets/images/icons/search_icon_004.svg" alt="">
                </button>
              </li>
            </ul>
            <div *ngIf="coverProgBar" class="spinner_sm_wrappar">
              <mat-spinner class="spinner_sm"></mat-spinner>
            </div>
            <div *ngIf="!coverProgBar" class="corres_table_wrapper">
              <table class="table_cover_letter" (mouseleave)="!attachTrigger ? hoveredIndexCover=null : null">
                <tr>
                  <th class="type">{{'type'| translator}}</th>
                  <th class="name" [ngClass]="expandedAction ? 'unexpanded-name' : 'expanded-name'">{{'name'| translator}}</th>
                  <th class="size" *ngIf="!expandedAction">{{'size'| translator}}</th>
                  <th class="modified" *ngIf="!expandedAction">{{'modified'| translator}}</th>
                  <th class="creator" *ngIf="!expandedAction">{{'creator'| translator}}</th>
                </tr>
                <tbody *ngFor="let correspondenceCoverDetails of externalIncCoverLetterData">
                  <tr *ngFor="let coverLetterData of correspondenceCoverDetails.myRows; let index=index"
                    (mouseover)="hoveredIndexCover=index" [class]="hoveredIndexCover===index ? 'hovered-row' : ''">
                    <td class="type" [innerHtml]="coverLetterData.CoverType">
                    <td class="name attachment-cover-data-container"
                      [ngClass]="expandedAction ? 'unexpanded-name' : 'expanded-name'">
                      <a class="coverLink"
                        (click)="getCoverDocumentURL(coverLetterData.Dataid)">{{coverLetterData.Name}}
                      </a>
                      <div
                        [class]="index===hoveredIndexCover ? 'group_btn_attachments_cover' : 'group_btn_attachments_cover hovered' ">
                        <div class="group_btn_attachments_cover_background">
                          <!-- <a matTooltip="Print" class="btn btn_006" href="#">
                                <img src="{{basehref}}assets/images/icons/printer-tool.svg" alt="">
                              </a> -->
                          <!-- <a matTooltip="Download" class="btn btn_006" href="{{CSUrl}}{{coverLetterData.DownloadURL}}">
                            <img src="{{basehref}}assets/images/icons/download-to-storage-drive.svg" alt="">
                          </a> -->
                          <a [matTooltip]="'properties' | translator" class="btn btn_006"
                            (click)=showActionProperties(coverLetterData.Dataid)>
                            <img src="{{basehref}}assets/images/icons/info-round-button.svg" alt="">
                          </a>
                          <a [matTooltip]="'edit' | translator" class="btn btn_006" *ngIf="coverLetterData.editperm=='TRUE'"
                            (click)="editFile(coverLetterData.Dataid, 'COVER')">
                            <img src="{{basehref}}assets/images/icons/toolbar_edit.svg" alt="">
                          </a>
                          <a *ngIf="coverLetterData.deleteperm=='TRUE'" [matTooltip]="'delete' | translator" class="btn btn_006"
                          (click)="deleteDocument(coverLetterData.Dataid,'COVER')">
                          <img src="{{basehref}}assets/images/icons/remove_icon_001.svg" alt="">
                        </a>
                          <a [matTooltip]="'translate' | translator" class="btn btn_006"
                            (click)=tranlsateDocument(coverLetterData.Dataid)>
                            <img src="{{basehref}}assets/images/icons/history.svg" alt="">
                          </a>
                          <a [matMenuTriggerFor]="attachMenu" (menuOpened)="attachTrigger=true"
                            (menuClosed)="attachTrigger=false" #otrigger="matMenuTrigger" [matTooltip]="'more_options' | translator"
                            class="btn btn_006">
                            <img src="{{basehref}}assets/images/icons/menu.svg" alt="">
                          </a>
                          <mat-menu #attachMenu="matMenu">
                            <a mat-menu-item [matTooltip]="'download' | translator"
                              href="{{CSUrl}}{{coverLetterData.DownloadURL}}">{{'download'| translator}}</a>
                            <a *ngIf="coverLetterData.addversionperm=='TRUE'" mat-menu-item [matTooltip]="'add_version' | translator"
                              (click)="openBrowseDocument($event,'file-inputAddversioncover')">{{'add_version'| translator}}</a>
                            <input id="file-inputAddversioncover" class="hidden-button" type="file"
                              (change)="addDocumentVersion($event.target.files,coverLetterData.Dataid,'COVER')" />
                          </mat-menu>
                        </div>
                      </div>
                    </td>

                    <td class="size" *ngIf="!expandedAction"> {{coverLetterData.CoverSize}} </td>
                    <td class="modified" *ngIf="!expandedAction">
                      {{coverLetterData.ModifyDate | date: 'dd/MM/yyyy HH:mm'}} </td>
                    <td class="creator" *ngIf="!expandedAction"> {{coverLetterData.CreatorName_EN}} </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel class="mat-elevation-z">
          <mat-expansion-panel-header (click)="getAttachmentSection()">
            <div class="icon_wrapper">
              <div class="icon_typ icon_typ_006">
                <img alt="" src="{{basehref}}assets/images/icons/attachment.svg">
              </div>
            </div>
            <p class="title_001">{{'attachments'| translator}}</p>
          </mat-expansion-panel-header>
          <div class="corres_data_area">
            <div class="attachments-container">
              <div *ngIf="progress" class="progress-container">
                <p>{{progress}}%</p>
                <mat-progress-bar style="width: 75%" [mode]="determinate" [value]="progress">
                </mat-progress-bar>
              </div>
              <ul class="cl_btn_group">
                <li class="cl_btn_wrp">
                  <button class="cl_btn cl_btn_001" (click)="refreshAttachmentSection()">
                    <img src="{{basehref}}assets/images/icons/refresh_arrow_white.svg" alt="">
                  </button>
                </li>

                <li class="cl_btn_wrp">
                  <div class="image-upload">
                    <label for="file-inputAttachment" class="cl_btn cl_btn_002" [matTooltip]="'add_document' | translator">
                      <img src="{{basehref}}assets/images/icons/cl_file_add_doc.svg" alt="">
                    </label>
                    <input id="file-inputAttachment" type="file"
                      (change)="uploadCSDocument($event.target.files,correspondenceData.AttachCorrAttachmentsID,'ATTACHMENT')" />
                  </div>
                </li>
                <li class="cl_btn_wrp">
                  <button class="cl_btn cl_btn_003" (click)="showCSCopy(correspondenceData.AttachCorrAttachmentsID)"
                    [matTooltip]="'copy_from_content_server' | translator">
                    <img src="{{basehref}}assets/images/icons/search_icon_004.svg" alt="">
                  </button>
                </li>
                <li class="cl_btn_wrp">
                  <button class="cl_btn cl_btn_003" [matTooltip]="'scan' | translator"
                    (click)="loadFolderPageForScan(correspondenceData.AttachCorrAttachmentsID)">
                    <img src="{{basehref}}assets/images/icons/scanner_white.svg" alt="">
                  </button>
                </li>
              </ul>
              <div *ngIf="ccProgbar" class="spinner_sm_wrappar">
                <mat-spinner class="spinner_sm"></mat-spinner>
              </div>
              <div *ngIf="!ccProgbar" class="corres_table_wrapper">
                <table class="table_attachments" (mouseleave)="!attachTrigger ? hoveredIndex=null : null">
                  <thead>
                    <tr>
                      <th class="type">{{'type'| translator}}</th>
                      <th class="name" [ngClass]="expandedAction ? 'unexpanded-name' : 'expanded-name'">{{'name'| translator}}</th>
                      <th class="size" *ngIf="!expandedAction">{{'size'| translator}}</th>
                      <th class="modified" *ngIf="!expandedAction">{{'modified'| translator}}</th>
                      <th class="creator" *ngIf="!expandedAction">{{'creator'| translator}}</th>
                    </tr>
                  </thead>
                  <tbody *ngFor="let corrAttachmentDetails of externalAttachmentFolderData">
                    <tr *ngFor="let attachmentData of corrAttachmentDetails.myRows; let index=index"
                      (mouseover)="hoveredIndex=index" [class]="hoveredIndex===index ? 'hovered-row' : ''">
                      <td class="type" [innerHtml]="attachmentData.attachmentType">
                      </td>
                      <td class="attachment-cover-data-container name"
                        [ngClass]="expandedAction ? 'unexpanded-name' : 'expanded-name'">
                        <a class="coverLink"
                          (click)="getCoverDocumentURL(attachmentData.Dataid)">{{attachmentData.Name}}
                        </a>
                        <div
                          [class]="index===hoveredIndex ? 'group_btn_attachments_cover' : 'group_btn_attachments_cover hovered' ">
                          <div class="group_btn_attachments_cover_background">
                            <!-- <button matTooltip="Print" class="btn btn_006">
                                <img src="{{basehref}}assets/images/icons/printer-tool.svg" alt="">
                              </button> -->
                            <!-- <a matTooltip="Download" class="btn btn_006" href="{{CSUrl}}{{attachmentData.DownloadURL}}">
                              <img src="{{basehref}}assets/images/icons/download-to-storage-drive.svg" alt="">
                            </a> -->
                            <a [matTooltip]="'properties' | translator" class="btn btn_006"
                              (click)=showActionProperties(attachmentData.Dataid)>
                              <img src="{{basehref}}assets/images/icons/info-round-button.svg" alt="">
                            </a>
                            <a [matTooltip]="'edit' | translator" class="btn btn_006" *ngIf="attachmentData.editperm=='TRUE'"
                              (click)="editFile(attachmentData.Dataid, 'ATTACHMENT')">
                              <img src="{{basehref}}assets/images/icons/toolbar_edit.svg" alt="">
                            </a>
                            <a *ngIf="attachmentData.deleteperm=='TRUE'" [matTooltip]="'delete' | translator" class="btn btn_006"
                            (click)="deleteDocument(attachmentData.Dataid,'ATTACHMENT')">
                            <img src="{{basehref}}assets/images/icons/remove_icon_001.svg" alt="">
                           </a>
                            <a [matTooltip]="'translate' | translator" class="btn btn_006"
                              (click)=tranlsateDocument(attachmentData.Dataid)>
                              <img src="{{basehref}}assets/images/icons/history.svg" alt="">
                            </a>
                            <a [matMenuTriggerFor]="attachMenu" (menuOpened)="attachTrigger=true"
                              (menuClosed)="attachTrigger=false" #otrigger="matMenuTrigger" [matTooltip]="'more_options' | translator"
                              class="btn btn_006">
                              <img src="{{basehref}}assets/images/icons/menu.svg" alt="">
                            </a>
                            <mat-menu #attachMenu="matMenu">
                              <a mat-menu-item href="{{CSUrl}}{{attachmentData.DownloadURL}}">{{'download'| translator}}</a>
                              <a mat-menu-item *ngIf="attachmentData.addversionperm=='TRUE'"
                                (click)="openBrowseDocument($event,'file-inputAddversionAttachment')">{{'add_version'| translator}}
                                </a>
                              <input id="file-inputAddversionAttachment" class="hidden-button" type="file"
                                (change)="addDocumentVersion($event.target.files,attachmentData.Dataid,'ATTACHMENT')" />
                            </mat-menu>
                          </div>
                        </div>
                      </td>
                      <td class="size" *ngIf="!expandedAction"> {{attachmentData.AttachmentSize}} </td>
                      <td class="modified" *ngIf="!expandedAction">
                        {{attachmentData.ModifyDate | date: 'dd/MM/yyyy HH:mm'}} </td>
                      <td class="creator" *ngIf="!expandedAction"> {{attachmentData.CreatorName_EN}} </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <!-- start -->
              <div class="drop_file_wrp">
                <ngx-file-drop dropZoneLabel="Drop files here"
                  (onFileDrop)="dropped($event,correspondenceData.AttachCorrAttachmentsID,'ATTACHMENT')"
                  (onFileOver)="fileOver($event)" (onFileLeave)="fileLeave($event)">
                  <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
                    {{'you_can_drag_drop_files_here'| translator}}
                  </ng-template>
                </ngx-file-drop>
              </div>
              <!-- end -->

            </div>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel class="mat-elevation-z bg_001" *ngIf="sectionDisplay.UserCollaboration.Show">
          <mat-expansion-panel-header (click)="collaborationShowData();">
            <div class="icon_wrapper">
              <div class="icon_typ icon_typ_007">
                <img src="{{basehref}}assets/images/icons/collaboration_icon.svg" alt="">
              </div>
            </div>
            <p class="title_001">{{'user_collaboration'| translator}}</p>
          </mat-expansion-panel-header>
          <div class="corres_data_area">
            <div *ngIf="userCollaborationProgbar" class="spinner_sm_wrappar">
              <mat-spinner class="spinner_sm"></mat-spinner>
            </div>
            <div *ngIf="!userCollaborationProgbar" class="corres_table_wrapper">
              <table class="table table_collaboration">
                <tr>
                  <th class="name">{{'name'| translator}}</th>
                  <th class="department">{{'department'| translator}}</th>
                  <th class="status">{{'status'| translator}}</th>
                  <th class="purpose">{{'purpose'| translator}}</th>
                  <th class="due_date">{{'due_date'| translator}}</th>
                  <th class="last_note">{{'last_notes'| translator}}</th>
                </tr>
                <tbody *ngFor="let correspondenceCollaborationDetails of correspondenceCollaborationDetail">
                  <tr *ngFor="let collaborationData of correspondenceCollaborationDetails.myRows">
                    <td>{{collaborationData.Name_EN}}</td>
                    <td>{{collaborationData.DepartmentName_EN}}</td>
                    <td>{{collaborationData.Status_EN}}</td>
                    <td>{{collaborationData.Purpose_EN}}</td>
                    <td>{{collaborationData.UserColl_DueDate}}</td>
                    <td>{{collaborationData.UserColl_Notes}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </mat-expansion-panel>
        <app-linked-correspondences [DataID]="locationid" [Name]="correspondenceData?.CorrFolderName"
          [Modify]="sectionDisplay.LinkedCorrespondence.Modify" (CoverAction)="LinkedCorrAction($event)">
        </app-linked-correspondences>
        <mat-expansion-panel class="mat-elevation-z bg_001" *ngIf="sectionDisplay.Comments.Show">
          <mat-expansion-panel-header (click)="commentsProgbar = false">
            <div class="icon_wrapper">
              <div class="icon_typ icon_typ_009">
                <img src="{{basehref}}assets/images/icons/comment_icon.svg" alt="">
              </div>
            </div>
            <p class="title_001">{{'comments'| translator}}</p>
          </mat-expansion-panel-header>
          <div class="corres_data_area">
            <div *ngIf="commentsProgbar" class="spinner_sm_wrappar">
              <mat-spinner class="spinner_sm"></mat-spinner>
            </div>
            <div *ngIf="!commentsProgbar && correspondenceData" class="input_item_wrp corres_comnt_area">
              <app-comment-section [data]="correspondenceData" [corrType]="CorrespondencType" [corrTaskID]="taskID">
              </app-comment-section>
            </div>
          </div>
        </mat-expansion-panel>
        <mat-expansion-panel class="mat-elevation-z bg_001 panal_pd_0" *ngIf="sectionDisplay.Transfer.Show">
          <mat-expansion-panel-header (click)="transferTabShowData()">
            <div class="icon_wrapper">
              <div class="icon_typ icon_typ_011">
                <img src="{{basehref}}assets/images/icons/transfer_icon.svg" alt="">
              </div>
            </div>
            <p class="title_001">{{'transfer'| translator}}</p>
          </mat-expansion-panel-header>
          <div class="corres_data_area transfer_wrapper">
            <div *ngIf="transferProgbar" class="spinner_sm_wrappar">
              <mat-spinner class="spinner_sm"></mat-spinner>
            </div>
            <div *ngIf="!transferProgbar" class="corres_table_wrapper">
              <div class="transfer_header">
                <button class="btn_007 mat-button" (click)="openTransferDialog()"><img
                    src="{{basehref}}assets/images/icons/plus_btn_green.svg" alt="">{{'select_transfer'| translator}}</button>
                <!-- (click)="transferTabShowData() should be deleted later -->
                <button class="btn_007 mat-button" (click)="transferTabShowData()"><img
                    src="{{basehref}}assets/images/icons/refresh-page-button.svg" alt="">{{'refresh'| translator}}</button>
              </div>
              <div class="transfer_list_item_wrp">
                <ul class="inside_acdn_header_002">
                  <li>{{'from'| translator}}</li>
                  <li>{{'to'| translator}}</li>
                  <li>{{'purpose'| translator}}</li>
                  <li>{{'transfer_date'| translator}}</li>
                  <li>{{'due_date'| translator}}</li>
                </ul>
                <div *ngFor="let transferDataDetails of transferhistorytabData">
                  <div *ngFor="let transferDataDetail of transferDataDetails.myRows"
                    [class.currentTransfer]="transferDataDetail.TransID.toString() === correspondenceData.ID.toString()">
                    <mat-accordion class="inside_accordion_001">
                      <mat-expansion-panel>
                        <mat-expansion-panel-header [collapsedHeight]="'auto'" [expandedHeight]="'auto'">
                          <ul class="inside_acdn_header_002 padd_none">

                            <li>{{transferDataDetail.SenderName}}</li>
                            <li>{{transferDataDetail.RecipientName}}</li>
                            <li>{{transferDataDetail.Purpose}}</li>
                            <li>{{transferDataDetail.TransferDate}}</li>
                            <li>{{transferDataDetail.TransferDueDate}}</li>
                          </ul>
                        </mat-expansion-panel-header>
                        <div class="inside_acdn_bdy">
                          <ul class="inside_acdn_contnt_002">
                            <li>
                              <span class="titl">{{'comments'| translator}} :</span>
                              <span>{{transferDataDetail.Notes}}</span>
                            </li>
                            <li>
                              <span class="titl">{{'completion_notes'| translator}}:</span>
                              <span>{{transferDataDetail.NotesComplete}}</span>
                            </li>
                          </ul>
                        </div>
                      </mat-expansion-panel>
                    </mat-accordion>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
        <app-distribution *ngIf="sectionDisplay.Distribution.Show && correspondenceData"
          [correspondenceData]="correspondenceData" [taskID]="taskID"
          (showDistributionChart)="showDistributionChart($event)">
        </app-distribution>
      </mat-accordion>
    </div>
    <div class="corp_dtl_btn_btm_wrapper">
      <button class="btn_008" *ngIf="showWFButtons.btnComplete"
        (click)="submitCorrespondenceInfo('SendOn')">{{'complete'| translator}}</button>
      <button class="btn_008" *ngIf="showWFButtons.btnPrnBarcode" printTitle="Barcode" printSectionId="print-section"
        ngxPrint>{{'actbtn_printbcode'| translator}}</button>
      <button class="btn_008" *ngIf="showWFButtons.btnPrnReceipt" printTitle="Reciept" printSectionId="print-reciept"
        ngxPrint>{{'print_reciept'| translator}}</button>
      <button class="btn_008" *ngIf="showWFButtons.btnSendFax">{{'send_fax'| translator}}</button>
      <button class="btn_008" *ngIf="showWFButtons.btnSendOn" (click)="submitCorrespondenceInfo('SendOn')">{{'send_on'| translator}}
        </button>
      <button class="btn_008" *ngIf="showWFButtons.btnSave" (click)="submitCorrespondenceInfo('Save')">{{'save'| translator}}</button>
      <button class="btn_008" *ngIf="showWFButtons.btnSendBack" (click)="openSendBackDialog()">{{'send_back'| translator}}</button>
      <button class="btn_008" *ngIf="showWFButtons.btnNotifExtComp"
        (click)="submitCorrespondenceInfo('WaitExtCompany')">{{'notify_external_company'| translator}}</button>
      <button class="btn_008" *ngIf="showWFButtons.btnDelete" (click)="submitCorrespondenceInfo('Terminate')">{{'delete_correspondence'| translator}}
        </button>
      <button class="btn_008" *ngIf="showWFButtons.btnToDashboard" (click)="backNavigation()">{{'back_to_dashboard'| translator}}</button>
      <!--       <button (click)="submitCorrespondenceInfo('TEST')">test</button>
        <button (click)="openSendBackDialog()">open dilaog</button> -->
      <!-- <button (click)="expandeActionLeftButton()" matRipple class="corsp_ext_btn">
          <img src="{{basehref}}assets/images/icons/full-screen.svg" alt="">
        </button> -->
    </div>

    <div class="corp_dtl_btn_btm_wrapper">
      <button (click)="expandeActionLeftButton()" matRipple class="corsp_ext_btn">
        <img src="{{basehref}}assets/images/icons/full-screen.svg" alt="">
      </button>
    </div>

    <div id="print-section" style="display:none">
      <span style="font-weight:bold;text-align :center;margin-left:15%">{{'public_works_authority'| translator}}</span><br>
      <span style="font-weight:bold;text-align :center;margin-left:20%">{{barcodeDate}}</span>
      <ngx-barcode [bc-value]="barcodeNumberToPrint" [bc-format]="CODE128" [bc-display-value]="true" [bc-font-size]="36"
        [bc-font]="Arial" [bc-text-margin]="5" [bc-height]="55"></ngx-barcode>
    </div>

    <div id="print-reciept" style="display:none">

      <head>
        <meta charset="UTF-8">
      </head>

      <body>
        <table border="0" cellpadding="0" cellspacing="0" style="left: 0px; top: 0px; width: 100%;">
          <tbody>
            <tr>
              <td width="50"><img border="0" src="{{basehref}}assets/images/headerbar_content_server_pwa.png"
                  style="width: 100px; height: 66px;" width="48"></td>
              <td width="150"></td>
              <td class="data-trn"
                style="font-weight: bold; font-size: 42px;text-align: left; vertical-align: middle !important;">{{'receipt'| translator}}
              </td>
            </tr>
          </tbody>
        </table>
        <hr>
        <table border="0" cellpadding="0" cellspacing="0" style="left: 0px; top: 0px; width: 100%;">
          <tbody>
            <tr>
              <td>{{'date_of_receipt'| translator}}:</td>
              <td>{{barcodeDate}}</td>
            </tr>
            <tr>
              <td>{{'correspondence_code'| translator}}:</td>
              <td>{{barcodeNumberToPrint}}</td>
            </tr>
        </table><br>
        <ngx-barcode [bc-value]="barcodeNumberToPrint" [bc-format]="CODE128" [bc-display-value]="true"
          [bc-font-size]="36" [bc-font]="Arial" [bc-text-margin]="5" [bc-height]="55"></ngx-barcode>
      </body>
    </div>

  </ng-scrollbar>
  <ng-scrollbar class="correspondence_deatil_prview_wrappper"
    [ngClass]="expandedRightAction ? 'unActive' : 'ActiveRight'" *ngIf="expandedAction">
    <button (click)="expandeActionRightButton()" matRipple class="corsp_ext_btn">
      <img src="{{basehref}}assets/images/icons/full-screen.svg" alt="">
    </button>
    <ng-container *ngIf="showPreviewCoverLetter">
      <div class="documentViewerDiv" *ngFor="let docpreviewData of documentPreviewURL">
        <iframe class="iframeclass" scrolling="no" frameborder="0"
          [src]="docpreviewData.CorrespondencedocumentURL|safe"></iframe>
      </div>
    </ng-container>

    <div *ngIf="showPreviewTreeArea">
      <div class="spinner_sm_wrappar" *ngIf="dataSource.data.length == 0"
        style="display: flex;height: calc(100vh - 100px);">
        <mat-spinner class="spinner_sm"></mat-spinner>
      </div>
      <h3 class="org_chrt_head" *ngIf="!dataSource.data.length == 0">{{'select'| translator}} {{selectedCaption}} {{'from_organizational_chart'| translator}}
      </h3>
      <div class="org_cht_header" *ngIf="!dataSource.data.length == 0">
        <div class="search_wrapper">
          <input class="org_search" type="text" [placeholder]="'ashgal_public_work_authority' | translator" #organizationalChartSearch
            (keyup.enter)="searchTreeValue(organizationalChartSearch.value)" [(ngModel)]="orgSearch">
          <button (click)="searchTreeValue(organizationalChartSearch.value)" class="search_btn"></button>
        </div>
        <div class="right_org_head">
          <mat-checkbox class="chk_emply" [(ngModel)]="showEmployees">{{'show_employees'| translator}}</mat-checkbox>
          <button mat-button class="btn_001" (click)="getSelectedIntDepartment()">{{'add'| translator}}</button>
        </div>
      </div>
      <div class="cover_ltr_pre" *ngIf="!dataSource.data.length == 0">
        <!-- single check box tree strt -->
        <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="tree_container"
          [ngClass]="{'show_employees': showEmployees, 'hide_employess':!showEmployees }">
          <mat-tree-node *matTreeNodeDef="let node" class="employees_wrapper">
            <div class="main_tree_wrapper">
              <div class="mat-tree-node">
                <div class="tree_icn_wrp flex_empl_wrp">
                  <button mat-icon-button matTreeNodeToggle class="emp_sho_btn" (click)="getEmplDetail(node)">
                    <mat-icon class="mat-icon-rtl-mirror show_employees_data_btn"
                      [ngClass]="{'activeIcon' : treeControl.isExpanded(node)}">
                      <!--   -->
                      {{treeControl.isExpanded(node) ? 'fiber_manual_record' : 'fiber_manual_record'}}
                    </mat-icon>
                  </button>
                  <mat-checkbox *ngIf="!multiSelect" (change)="selectSinglCheckboxOrg(node,$event)"
                    [checked]="currentlyChecked == node">
                    <!-- (change)="getOrgSelectDetail(node)"  -->
                    <div class="org_text_wrp">
                      <div class="org_icon_wrp folder">
                        <img class="org_img_001" src="{{basehref}}assets/images/icons/folder_001.svg" alt="">
                      </div>
                      <p class="org_chart_text" [class.search-result]="node.wanted && searchResult(node)">
                        {{node.Name}}</p>
                    </div>
                  </mat-checkbox>
                  <mat-checkbox *ngIf="multiSelect" (change)="selectSinglCheckboxOrg(node,$event)">
                    <div class="org_text_wrp">
                      <div class="org_icon_wrp folder">
                        <img class="org_img_001" src="{{basehref}}assets/images/icons/folder_001.svg" alt="">
                      </div>
                      <p class="org_chart_text" [class.search-result]="node.wanted && searchResult(node)">{{node.Name}}
                      </p>
                    </div>
                  </mat-checkbox>
                </div>
              </div>
              <div *ngIf="showEmployees" class="show_empl_name_wrp">
                <ul *ngIf="treeControl.isExpanded(node)" class="show_empl_name_ul">
                  <ng-container *ngIf="showempDetails">
                    <li class="show_empl_name" *ngFor="let empList of employeeMap |employeemaplist:node.OUID">
                      <mat-checkbox *ngIf="!multiSelect" (change)="selectSinglCheckboxEmp(empList,$event)"
                        [checked]="currentlyChecked == empList">
                        <div class="org_text_wrp">
                          <div class="org_icon_wrp user">
                            <img class="org_img_001" src="{{basehref}}assets/images/icons/{{empList.LevelImage}}" alt="">
                          </div>
                          <p class="org_chart_text" [class.search-result]="empList.wanted">{{empList?.Coev_Firstname}}
                            {{empList?.Coev_LastName}}</p>
                        </div>
                      </mat-checkbox>
                      <mat-checkbox *ngIf="multiSelect" (change)="selectSinglCheckboxEmp(empList,$event)">
                        <div class="org_text_wrp">
                          <div class="org_icon_wrp user">
                            <img class="org_img_001" src="{{basehref}}assets/images/icons/{{empList.LevelImage}}" alt="">
                          </div>
                          <p class="org_chart_text" [class.search-result]="empList.wanted">{{empList?.Coev_Firstname}}
                            {{empList?.Coev_LastName}}</p>
                        </div>
                      </mat-checkbox>
                    </li>
                  </ng-container>
                </ul>
              </div>
            </div>
          </mat-tree-node>
          <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild" class="main_tree_wrapper">
            <!--  -->
            <div class="full_fil_wrapper">
              <div class="mat-tree-node">
                <div class="tree_icn_wrp">
                  <div class="{{node.employees_status}}">
                    <button *ngIf="node.children.length > 0" mat-icon-button matTreeNodeToggle
                      [attr.aria-label]="'toggle ' + node.Name" (click)="getEmplDetail(node)">
                      <mat-icon class="mat-icon-rtl-mirror" [ngClass]="{'activeIcon' : treeControl.isExpanded(node)}">
                        <!-- {{treeControl.isExpanded(node) ? 'fiber_manual_record' : 'fiber_manual_record'}} -->
                        {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                      </mat-icon>
                    </button>
                  </div>
                  <mat-checkbox *ngIf="!multiSelect" (change)="selectSinglCheckboxOrg(node,$event)"
                    [checked]="currentlyChecked == node">
                    <div class="org_text_wrp">
                      <div class="org_icon_wrp folder">
                        <img class="org_img_001" src="{{basehref}}assets/images/icons/folder_001.svg" alt="">
                      </div>
                      <p class="org_chart_text" [class.search-result]="node.wanted && searchResult(node)">{{node.Name}}
                      </p>
                    </div>
                  </mat-checkbox>
                  <mat-checkbox *ngIf="multiSelect" (change)="selectSinglCheckboxOrg(node,$event)">
                    <div class="org_text_wrp">
                      <div class="org_icon_wrp folder">
                        <img class="org_img_001" src="{{basehref}}assets/images/icons/folder_001.svg" alt="">
                      </div>
                      <p class="org_chart_text" [class.search-result]="node.wanted && searchResult(node)">{{node.Name}}
                      </p>
                    </div>
                  </mat-checkbox>
                </div>
              </div>

              <div *ngIf="showEmployees" class="show_empl_name_wrp">
                <ul *ngIf="treeControl.isExpanded(node)" class="show_empl_name_ul">
                  <ng-container *ngIf="showempDetails">
                    <li class="show_empl_name" *ngFor="let empList of employeeMap |employeemaplist:node.OUID">
                      <mat-checkbox *ngIf="!multiSelect" (change)="selectSinglCheckboxEmp(empList,$event)"
                        [checked]="currentlyChecked == empList">
                        <div class="org_text_wrp">
                          <div class="org_icon_wrp user">
                            <img class="org_img_001" src="{{basehref}}assets/images/icons/{{empList.LevelImage}}" alt="">
                          </div>
                          <p class="org_chart_text" [class.search-result]="empList.wanted">{{empList?.Coev_Firstname}}
                            {{empList?.Coev_LastName}}</p>
                        </div>
                      </mat-checkbox>
                      <mat-checkbox *ngIf="multiSelect" (change)="selectSinglCheckboxEmp(empList,$event)">
                        <div class="org_text_wrp">
                          <div class="org_icon_wrp user">
                            <img class="org_img_001" src="{{basehref}}assets/images/icons/{{empList.LevelImage}}" alt="">
                          </div>
                          <p class="org_chart_text" [class.search-result]="empList.wanted">{{empList?.Coev_Firstname}}
                            {{empList?.Coev_LastName}}</p>
                        </div>
                      </mat-checkbox>
                    </li>
                  </ng-container>
                </ul>
              </div>

              <div [class.node_wrapper_invisible]="!treeControl.isExpanded(node)"
                class="tree_nested_node_child hide_employess">
                <ng-container matTreeNodeOutlet></ng-container>
              </div>
            </div>
          </mat-nested-tree-node>
        </mat-tree>
      </div>
    </div>
    <div *ngIf="showPreviewECMDTreeArea">
      <h3 class="org_chrt_head">{{'select'| translator}} {{selectedCaption}} {{'from_external_counterparts_chart'| translator}}
      </h3>
      <div class="org_cht_header">
        <div class="search_wrapper">
          <input class="org_search" type="text" [placeholder]="'search_for_ext_counterpart' | translator" #ECMDChartSearch
            (keyup.enter)="searchCounterParts(ECMDChartSearch.value)">
          <button (click)="searchCounterParts(ECMDChartSearch.value)" class="search_btn"></button>
        </div>
        <div class="right_org_head">
          <input class="ecmd_search" type="text" [placeholder]="'type_name' | translator" #ECMDName>
          <button mat-button class="btn_001" [disabled]="!currentlyChecked"
            (click)="getSelectedECMD(ECMDName.value)">{{'add'| translator}}</button>
        </div>
      </div>
      <div *ngIf="isLoading" class="spinner_sm_wrappar">
        <mat-spinner class="spinner_sm"></mat-spinner>
      </div>
      <div *ngIf="!isLoading" class="cover_ltr_pre">
        <mat-tree [dataSource]="dataSourceECMD" [treeControl]="treeControlECMD" class="tree_container">
          <mat-tree-node *matTreeNodeDef="let node" class="employees_wrapper">
            <div class="main_tree_wrapper">
              <div class="mat-tree-node" [class.selected-item]="currentlyChecked == node">
                <div class="tree_icn_wrp flex_empl_wrp">
                  <button mat-icon-button matTreeNodeToggle (click)="ECMDTreeOpenAction(node)">
                    <mat-icon *ngIf="node.hasOwnProperty('children') && !node.isLoading">
                      {{treeControlECMD.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                    </mat-icon>
                    <mat-spinner *ngIf="node.isLoading" class="ecmd-tree-spinner"></mat-spinner>
                  </button>
                  <div class="org_text_wrp ecmd_text_wrp" (click)="selectECMD(node)">
                    <div class="ecmd_icon_wrp" [ngClass]="ecmdTreeType(node)">
                      <img *ngIf="ecmdTreeType(node) === 'folder'" class="ecmd_img_001"
                        src="{{basehref}}assets/images/icons/folder_001.svg" alt="">
                      <p *ngIf="ecmdTreeType(node) === 'counterpart'" class="ecmd_initial_001">
                        {{getInitials(node.Name)}}</p>
                      <p *ngIf="ecmdTreeType(node) === 'department'" class="ecmd_initial_001">{{getInitials(node.Name)}}
                      </p>
                    </div>
                    <p class="org_chart_text ecmd_char_text">{{node.Name}}<span
                        *ngIf="ecmdTreeType(node) === 'folder' && !isSearchResult">({{node.CounterParts}})</span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </mat-tree-node>
          <mat-nested-tree-node *matTreeNodeDef="let node; when: ECMDhasChild" class="main_tree_wrapper">
            <div class="full_fil_wrapper">
              <div class="mat-tree-node" [class.selected-item]="currentlyChecked == node">
                <div class="tree_icn_wrp">
                  <div class="{{node.employees_status}}">
                    <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.Name">
                      <mat-icon class="mat-icon-rtl-mirror"
                        [ngClass]="{'activeIcon' : treeControlECMD.isExpanded(node)}">
                        {{treeControlECMD.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                      </mat-icon>
                    </button>
                  </div>
                  <div class="org_text_wrp ecmd_text_wrp" (click)="selectECMD(node)">
                    <div class="ecmd_icon_wrp" [ngClass]="ecmdTreeType(node)">
                      <img *ngIf="ecmdTreeType(node) === 'folder'" class="ecmd_img_001"
                        src="{{basehref}}assets/images/icons/folder_001.svg" alt="">
                      <p *ngIf="ecmdTreeType(node) === 'counterpart'" class="ecmd_initial_001">
                        {{getInitials(node.Name)}}</p>
                      <p *ngIf="ecmdTreeType(node) === 'department'" class="ecmd_initial_001">{{getInitials(node.Name)}}
                      </p>
                    </div>
                    <p class="org_chart_text">{{node.Name}}<span
                        *ngIf="ecmdTreeType(node) === 'folder' && !isSearchResult">({{node.CounterParts}})</span></p>
                  </div>
                </div>
              </div>
              <div [class.node_wrapper_invisible]="!treeControlECMD.isExpanded(node)"
                class="tree_nested_node_child hide_employess">
                <ng-container matTreeNodeOutlet></ng-container>
              </div>
            </div>
          </mat-nested-tree-node>
        </mat-tree>
      </div>
    </div>

    <app-distribution-chart *ngIf="showDistributionTreeArea && correspondenceData"
      [correspondenceData]="correspondenceData" (distributionOutputAction)="distributionOutputAction($event)">
    </app-distribution-chart>
  </ng-scrollbar>
</div>